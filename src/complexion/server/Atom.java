package complexion.server;


import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import complexion.resource.Sprite;
import complexion.common.Utils;
import complexion.common.Verb;
/**
 * Server-side representation of a game Atom.
 * 
 * This includes game-logic stuff, such as atom-interaction(Bump, Enter, etc.),
 * verbs, user-defined functions and so on.
 */
public class Atom {
		// Unique ID of the object, generated by the server.
		public Integer UID; 
		
		// Position on the map
		public int x,y;
		
		// Sprite the object is currently associated with.
		public Sprite sprite;  
		
		// Determines whether the object will be rendered above or
		// below other objects
		public int layer;
		
		// Each sprite has multiple states, which are more or less
		// sprites of their own. sprite_state determines which state
		// is used.
		public String sprite_state;
		
		// TODO: Add a way for the server to restart an animation
		//       (similar to the BYOND flick proc)
		
		// A sprite can define different appearances depending on the
		// direction. This variable should be one of the constants defined
		// in complexion.Directions
		public int direction;
		
		
		/**
		 * Call an atom verb with the given name(key) and arguments.
		 * TODO: Make sure only functions we expressly make available over the network
		 * 		 can be called this way.
		 * 
		 * @param key Name of the function/verb to be called.
		 * @param args A list of objects to be passed as args. These objects will be type-checked
		 * 			   before being passed to the function.
		 * @return true on success, false on failure
		 */

		public Atom(String msg)
		{
			System.out.println(msg);
		}
		
		public Atom() {
			// TODO Auto-generated constructor stub
		}
		@SuppressWarnings("rawtypes")
		public boolean callVerb(String key,Object[] args)
		{
			Class[] classes = Utils.toClasses(args);
			Method func;
			try {
				func = this.getClass().getMethod(key,classes);
			} catch (SecurityException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
				return false;
			} catch (NoSuchMethodException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
				return false;
			}
			// if @Verb does not exist fail nicely and don't allow it to be called.
			if(func.getAnnotation(Verb.class) == null)
			{
				System.err.println(key+" method is not in the verbs list!.. error at line 80 in Atom.callVerb");
				return false;
			}
			if(func != null)
			{
				try {
					func.invoke(this, args);
				} catch (IllegalArgumentException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
					return false;
				} catch (IllegalAccessException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
					return false;
				} catch (InvocationTargetException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
					return false;
				}
				return true;
			}
			return false; //Apparently this is dead code?
		}

}
